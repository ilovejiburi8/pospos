<script>
  (function() {
    // ★ あなたの GAS WebアプリURL（最後に ? は付けない）
    const GAS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbwnhKiz8HRr95vJP00Ke0LO1x2MYdZqKAgu9B4GHUbUPZbC-M5qs4go7itg3q6W9ORGaQ/exec';

    // ★ AppSheet側の遷移先URL
    const APPSHEET_BASE = 'https://www.appsheet.com/start/32751f13-1acd-4d48-b973-8254b9d92a59';

    const params = new URLSearchParams(window.location.search);
    const tableId = params.get('tableId');

    if (!tableId) {
      document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('msg').textContent =
          'tableId がURLに指定されていません。（例：?tableId=table1）';
      });
      return;
    }

    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('msg').textContent =
        'テーブル [' + tableId + '] の更新日時を記録しています...';
    });

    // ===== ここで GAS の処理完了を待つ =====
    const url = GAS_ENDPOINT + '?tableId=' + encodeURIComponent(tableId);

    fetch(url, { method: 'GET' })
      .then(function(res) {
        return res.json();   // JSON をパース
      })
      .then(function(data) {
        console.log('GAS response:', data);
        if (data.ok) {
          // 成功したら AppSheet にリダイレクト
          window.location.href = APPSHEET_BASE;
        } else {
          // 失敗したらエラー表示して止める
          document.getElementById('msg').textContent =
            'GAS の更新に失敗しました：' + (data.message || '不明なエラー');
        }
      })
      .catch(function(err) {
        console.error(err);
        document.getElementById('msg').textContent =
          'GAS 呼び出しでエラーが発生しました：' + err;
      });
  })();
</script>
